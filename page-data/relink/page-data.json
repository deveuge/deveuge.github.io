{"componentChunkName":"component---src-templates-blog-post-js","path":"/relink/","result":{"data":{"site":{"siteMetadata":{"title":"Deveuge"}},"markdownRemark":{"id":"7ec4b43f-7068-5152-8875-1b6255e92cb0","excerpt":"Relink - URL Shortener Relink is a Java Spring based shortening service consisting in: Key Generation Service (KGS): Allows the creation (and deletion) of…","html":"<h1 id=\"relink---url-shortener\">Relink - URL Shortener</h1>\n<p>Relink is a Java Spring based shortening service consisting in:</p>\n<ul>\n<li><strong>Key Generation Service</strong> (KGS): Allows the creation (and deletion) of hashes to be used in short urls. New and used hashes are stored in different tables.</li>\n<li><strong>API</strong>: Entry point for using the service. Allows the creation, consultation and deletion of urls. Uses a Redis chache to avoid querying the database for those urls that are consulted the most. It also contains a scheduled task for the deletion of expired urls. Consumes the KGS module.</li>\n<li><strong>Application</strong>: Visual interface for end users. Consumes the API module.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 501px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0d59857689b60d6f0b10852f26011f5b/55811/diagram.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.48648648648649%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAADRUlEQVQoz21TbWhTVxh+b3vBOvTHGBs0Q5TCxIF/98sflYEo0tlhZS443WZ1FBk4EVEHg4GOKThm7TbYBDtmwa42Wc1HW5N0nfemyf0wt0lsmpumXdLepPm4+c5NP2bsu3MzGIz1wMs55/143uc5Lwdgk5W1W6j0IzOkzMOGGudxrQgcp/FeZlXkp1c87juoZiDMMNR0RG2OFRD4ueq5SHoDhagW2wwPcmN2Kmt9BKnfTLvXfCKWOS8uuRy4Kj1F2TIik5SWt/fto48dP9WCiGBnw98/lVWckJIIkiRRwWDwXyN3WB7+lVo2DUHi4eCrFTfTV3Iz9zQPe3fx8djAp2fPhA4dPtx24OBBGBgep7lQGjyzeaMgq2tPAik38DwPfr8fZmZmdHDw+XzwrVOAJ/f6IMvYYXHKCZiNgc4kK7kJua0vH+vq2mI0GgGaW2DcbgFRVhvKfjE5ASYnJ1u9Xm8rAW1lWdZgtVpfuf3Nd/COcT/UMNIkxhyGB2M/tV3v/XyvpEy8Pr/BbT9ytAOq9WKjiZNfAGF+pdUf087xc+UDUCgUcpVKJZfP5zOapq3XajWrnqjbg4mf3wgm/UvBZKAkLvD5sDq7+iztb8S/unWz6cf7I/QqOU+F8l/MkaGQ4dShWCxiqVTCRCKBBAxtNluEsH9Jl3Dj7rW3/IqEBBDFPwX0hKewr793moToHYad9PEPTm/RwW3MbO9UUEGHsIigKMrZTCbzSbVa7ZZl+UJPT4+lfX/7jvdOdoFfdW8PLIvdXJT9TIx5zt8f6b924tT7X+rNui+fhDoi5eLnQZzX2n3RouAO5X4AwgyIXF06ENCG1IsXr1LW8a9hfUOAuMISX7zhlyMOsgfg3Y4O+syHpxuDGDLbILz8HFiWgceeOYBkMkmrqkqnUimaSG7+5/1moJYwQzk+9NrzPNu/pjLDJcVlflHymLHMXmFdg+AcHaT0XG0dIRjXqPq6Bt5QtqnRpbOz8z9WXrQ01RIWqMRNu7EiopZmUZFH8a8Ch6no2AIpofS6m9cvwe+BHDikLIjRKnjl8qYfBVaSVqqmjIC2ZDK8KHpH60WO2ShxE+XkH8LDgVuDu9r2bNvz5l74+KMT/6v9G85VIsi4drTwAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"System diagram\"\n        title=\"System diagram\"\n        src=\"/static/0d59857689b60d6f0b10852f26011f5b/55811/diagram.png\"\n        srcset=\"/static/0d59857689b60d6f0b10852f26011f5b/12f09/diagram.png 148w,\n/static/0d59857689b60d6f0b10852f26011f5b/e4a3f/diagram.png 295w,\n/static/0d59857689b60d6f0b10852f26011f5b/55811/diagram.png 501w\"\n        sizes=\"(max-width: 501px) 100vw, 501px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<hr>\n<h2 id=\"concept\">Concept</h2>\n<p>A URL shortening service is a website that significantly reduces the length of a Uniform Resource Locator (URL). The shortened URL then redirects the user to the original website’s URL. Well-known URL shortening services include <a href=\"tinyurl.com\">Tinyurl</a> and <a href=\"bitly.com\">Bitly</a>.</p>\n<h3 id=\"functionality\">Functionality</h3>\n<p>At a high level, a URL shortener performs the following operations:</p>\n<ul>\n<li>The server creates a unique shortened URL for each original long URL.</li>\n<li>The server encodes the shortened URL for ease of readability.</li>\n<li>The server stores the shortened URL in the database.</li>\n<li>The server redirects the user to the original long URL using the shortened URL.</li>\n</ul>\n<p>Reasons for shortening URLs:</p>\n<ul>\n<li><strong>Track clicks for analytics</strong>: To monitor and analyze click data.</li>\n<li><strong>Beautify URLs</strong>: To make URLs more aesthetically pleasing.</li>\n<li><strong>Disguise underlying URLs</strong>: Often used by affiliates.</li>\n<li><strong>Character limits</strong>: Some instant messaging services restrict the number of characters in a URL.</li>\n<li><strong>Ease of sharing</strong>: Useful for sharing via SMS/tweets (where character limits apply) and when printed in books/magazines (fewer characters mean lower printing costs). Additionally, short URLs are easier and less error-prone to type compared to their longer counterparts.</li>\n</ul>\n<h2 id=\"requirements\">Requirements</h2>\n<h3 id=\"functional-requirements\">Functional Requirements</h3>\n<ul>\n<li>When provided with a long URL, the service must create a shorter, unique alias.</li>\n<li>If different users input the same long URL, they should receive the same short URL (1-to-1 mapping).</li>\n<li>The short URL must be easy to read, free of collisions and not predictable.</li>\n<li>The service should redirect users to the original URL when they hit the short link.</li>\n<li>Links should expire after a default time span.</li>\n<li>Implement measures to prevent misuse of the service.</li>\n</ul>\n<h3 id=\"non-functional-requirements\">Non-Functional Requirements</h3>\n<ul>\n<li>Ensure high availability.</li>\n<li>Maintain low latency.</li>\n<li>Ensure high scalability.</li>\n<li>Maintain durability.</li>\n<li>Ensure fault tolerance.</li>\n</ul>\n<h2 id=\"system-analysis\">System Analysis</h2>\n<h3 id=\"components\">Components</h3>\n<ul>\n<li><strong>Client</strong>: These are the web browsers that will interact with the backend servers through the HTTP protocol.</li>\n<li><strong>Load Balancer</strong>: This component is responsible for evenly distributing the workload among the backend servers.</li>\n<li><strong>Web Servers</strong> : Several web server instances will be deployed to facilitate horizontal scaling.</li>\n<li><strong>Database</strong>: It will store the association between long URLs and their shortened counterparts.</li>\n</ul>\n<h3 id=\"capacity-estimation\">Capacity estimation</h3>\n<h4 id=\"traffic\">Traffic</h4>\n<p>Considering this system will be read-heavy, we will assume a 100:1 read/write ratio with 100 million links generated each month.</p>\n<ul>\n<li>Shortened links created per month: <strong>100 million</strong>.</li>\n<li>Requests Per Second (RPS): 100 million / (30 days _ 24 hours _ 3600 seconds ) = <strong>~40 URLs/second</strong></li>\n<li>Number of redirections: 40 URLs/s * 100 = <strong>4000 URLs/s</strong></li>\n</ul>\n<h4 id=\"bandwidth\">Bandwidth</h4>\n<p>Since we anticipate around 40 URLs every second, and if we assume each request is approximately 500 bytes in size, the total incoming data for write requests would be:</p>\n<ul>\n<li>40 urls x 500 bytes = <strong>20 KB/s</strong></li>\n</ul>\n<p>Similarly, for read requests, with an expectation of about 4.000 redirections, the total outgoing data would be:</p>\n<ul>\n<li>4000 urls x 500 bytes = <strong>~2MB/s</strong></li>\n</ul>\n<h4 id=\"storage\">Storage</h4>\n<p>We’ll assume that each link or record in our database will be stored for 5 years. With an expectation of approximately 100 million new requests each month, the total number of records that will need to store would be:</p>\n<ul>\n<li>100 million x 5 years x 12 months = <strong>6 billion</strong></li>\n</ul>\n<p>Assuming each stored record will be around 500 bytes (with an average URL length of 100 bytes), the total storage required will be approximately 3TB:</p>\n<ul>\n<li>6 billion x 500 bytes = <strong>3TB</strong></li>\n</ul>\n<h4 id=\"cache\">Cache</h4>\n<p>For caching, we will adopt the Pareto principle, also known as the 80/20 rule. This means that 80% of the requests are for 20% of the data, so we can cache approximately 20% of our requests.</p>\n<p>Given that we expect around 4.000 read or redirection requests per second, this equates to roughly 350 million requests per day:</p>\n<ul>\n<li>4000 URLs/second×24 hours×3600 seconds= <strong>∼350 million requests/day</strong></li>\n</ul>\n<p>Therefore, we will need around 35GB of memory per day for caching:</p>\n<ul>\n<li>20% × 350 million requests × 500 bytes= <strong>35 GB/day</strong></li>\n</ul>\n<h3 id=\"high-level-estimate\">High-level estimate</h3>\n<table>\n<thead>\n<tr>\n<th>Type</th>\n<th>Estimate</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Writes (New URLs)</td>\n<td>40/s</td>\n</tr>\n<tr>\n<td>Reads (Redirection)</td>\n<td>4K/s</td>\n</tr>\n<tr>\n<td>Bandwidth (Incoming)</td>\n<td>20 KB/s</td>\n</tr>\n<tr>\n<td>Bandwidth (Outgoing)</td>\n<td>2 MB/s</td>\n</tr>\n<tr>\n<td>Storage (5 years)</td>\n<td>3 TB</td>\n</tr>\n<tr>\n<td>Memory (Caching)</td>\n<td>~35 GB/day</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"database-schema\">Database Schema</h3>\n<p>Given that the data isn’t strongly relational, NoSQL databases like <a href=\"https://aws.amazon.com/es/dynamodb/\">Amazon DynamoDB</a>, <a href=\"https://cassandra.apache.org/_/index.html\">Apache Cassandra</a>, or <a href=\"https://www.mongodb.com/es\">MongoDB</a> would be more suitable. However, if an SQL database is needed, options like Azure SQL Database or Amazon RDS could be considered.\nIn our system, relational queries will be infrequent, so opting for a NoSQL database would simplify scaling.</p>\n<p>Data Related to the <strong>User</strong>:</p>\n<ul>\n<li><strong>User ID</strong>: A unique identifier or API key to make each user globally distinguishable.</li>\n<li><strong>Name</strong>: The user’s name.</li>\n<li><strong>Email</strong>: The user’s email address.</li>\n</ul>\n<p>Data Related to the <strong>Link</strong>:</p>\n<ul>\n<li><strong>Hash</strong>: A 7 character long unique short URL.</li>\n<li><strong>Original URL</strong>: The original long URL.</li>\n<li><strong>User ID</strong>: The unique identifier or API key of the user who created the short URL.</li>\n<li><strong>Expiration date</strong>: The date on which the short URL will expire.</li>\n</ul>\n<p>Additionally, we could use the originalUrl column as an index to improve query performance.</p>\n<h3 id=\"shortening-algorithm\">Shortening Algorithm</h3>\n<h4 id=\"base62-approach\">Base62 Approach</h4>\n<p>In this method, we encode the original URL using Base62, which comprises uppercase letters (A-Z), lowercase letters (a-z), and digits (0-9) (26 + 26 + 10 = 62).\nWith a 7-character short URL, we can generate 62^7 (~3500 billion) URLs, which is ample. We generate a random number for the long URL, convert it to Base62, and use this hash as the short URL ID.\nAssuming the service creates 4000 URLs/sec, it would take 27 years to exhaust the 3500 billion combinations:</p>\n<ul>\n<li>4000 x 60 x 60 x 24 x 365 = 126.144.000.000 urls/year</li>\n<li>3500 billion / 126.144.000.000 urls/year = <strong>~27 years</strong></li>\n</ul>\n<p>The longer the key, the more URLs available, reducing the risk of running out. However, <strong>this simplest solution doesn’t ensure non-duplicate or collision-free keys</strong>.</p>\n<h4 id=\"md5-approach\">MD5 Approach</h4>\n<p>The MD5 hash function generates a 128-bit hash (32 hexadecimal digits). We could use these to create a 7-character short URL:</p>\n<ul>\n<li>MD5(original url) → base62encode → hash</li>\n</ul>\n<p><strong>This method risks duplication and collisions</strong>. Recomputing the hash until finding a unique one increases system overhead, making this <strong>less scalable</strong>.</p>\n<h4 id=\"counter-approach\">Counter Approach</h4>\n<p>Here, a single server maintains a count of generated keys. Each request increments the counter, yielding a unique number which is then Base62 encoded:</p>\n<ul>\n<li>Counter(0−3.5 trillion) → base62encode → hash</li>\n</ul>\n<p><strong>This approach risks becoming a single point of failure</strong>. Multiple instances can lead to collisions, needing a distributed system manager like Zookeeper for synchronization. Zookeeper can manage multiple ranges for servers, assigning new ranges as needed. This ensures unique, collision-free URLs, and multiple instances remove single points of failure.</p>\n<ul>\n<li>Range 1: 1 → 1.000.000​</li>\n<li>Range 2: 1.000.001 → 2.000.000​</li>\n<li>Range 3: 2.000.001 → 3.000.000​…</li>\n</ul>\n<p>Once a server reaches its maximum range Zookeeper will assign an unused counter range to the new server. This approach can guarantee non-duplicate and collision-resistant URLs. Also, we can run multiple instances of Zookeeper to remove the single point of failure.</p>\n<h4 id=\"key-generation-service-kgs\">Key Generation Service (KGS)</h4>\n<p>A standalone Key Generation Service (KGS) generates unique keys ahead of time, storing them in a database for future use. Marking keys as used upon retrieval prevents reuse. Multiple server instances might try to use the same key, so KGS stores keys in two tables: one for unused keys and one for used keys. Upon use, keys move to the used table. KGS should ensure no key duplication among servers, requiring data structure synchronization.</p>\n<p>To avoid KGS becoming a single point of failure, a standby replica can take over if the primary server fails. Background worker processes can generate Base62 random strings, verify uniqueness, and maintain a buffer of ready-to-use keys.</p>\n<h2 id=\"url-shortener-api\">URL Shortener API</h2>\n<p>The components in the system expose the Application Programming Interface (API) endpoints through Representational State Transfer (<a href=\"https://en.wikipedia.org/wiki/REST\">REST</a>) because of loose coupling and easiness to debug. We’re using an API key to prevent abuse of our services. Using this API key we can limit the users to a certain number of requests per second or minute.</p>\n<h3 id=\"create-url\">Create URL</h3>\n<p>Creates a new short URL in our system given an original URL.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">create(originalURL: string, expiration?: Date): string</code></pre></div>\n<ul>\n<li>\n<p>Parameters</p>\n<ul>\n<li><strong>Original Url</strong> (String): Original URL to be shortened.</li>\n<li><strong>Expiration</strong> (Date): Expiration date of the new URL (optional).</li>\n</ul>\n</li>\n<li>\n<p>Returns</p>\n<ul>\n<li><strong>Hash</strong> (String): New shortened URL.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"get-url\">Get URL</h3>\n<p>Retrieves the original URL from a given short URL.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">get(shortURL: String): string</code></pre></div>\n<ul>\n<li>\n<p>Parameters</p>\n<ul>\n<li><strong>API Key</strong> (String): API key provided by the user.</li>\n<li><strong>Hash</strong> (String): Short URL mapped to the original URL.</li>\n</ul>\n</li>\n<li>\n<p>Returns</p>\n<ul>\n<li><strong>Original URL</strong> (String): Original URL to be retrieved.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"delete-url\">Delete URL</h3>\n<p>Deletes a given shor tURL from our system.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">delete(shortURL: string): boolean</code></pre></div>\n<ul>\n<li>\n<p>Parameters</p>\n<ul>\n<li><strong>Hash</strong> (String): Short URL to be deleted.</li>\n</ul>\n</li>\n<li>\n<p>Returns</p>\n<ul>\n<li><strong>Result</strong> (boolean): Represents whether the operation was successful or not.</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p><strong>NOTE:</strong> The access to the API will require authentication (an API key) as a token header name (“X-API-KEY”) in each request.</p>\n</blockquote>\n<h2 id=\"cache-1\">Cache</h2>\n<p>We can cache URLs that are frequently accessed. We can use some off-the-shelf solution like <a href=\"https://redis.io/\">Redis</a>, which can store full URLs with their respective hashes. Before hitting backend storage, the application servers can quickly check if the cache has the desired URL.</p>\n<hr>\n<h2 id=\"bibliography\">Bibliography</h2>\n<ul>\n<li><a href=\"https://www.geeksforgeeks.org/system-design-url-shortening-service/\">https://www.geeksforgeeks.org/system-design-url-shortening-service/</a></li>\n<li><a href=\"https://medium.com/@sandeep4.verma/system-design-scalable-url-shortener-service-like-tinyurl-106f30f23a82\">https://medium.com/@sandeep4.verma/system-design-scalable-url-shortener-service-like-tinyurl-106f30f23a82</a></li>\n<li><a href=\"https://dev.to/karanpratapsingh/system-design-url-shortener-10i5\">https://dev.to/karanpratapsingh/system-design-url-shortener-10i5</a></li>\n<li><a href=\"https://www.enjoyalgorithms.com/blog/design-a-url-shortening-service-like-tiny-url\">https://www.enjoyalgorithms.com/blog/design-a-url-shortening-service-like-tiny-url</a></li>\n<li><a href=\"https://systemdesign.one/url-shortening-system-design/#url-shortener-api\">https://systemdesign.one/url-shortening-system-design/#url-shortener-api</a></li>\n<li><a href=\"https://sagarvasa.medium.com/url-shortener-service-a-basic-system-design-approach-96c9c371c197\">https://sagarvasa.medium.com/url-shortener-service-a-basic-system-design-approach-96c9c371c197</a></li>\n<li><a href=\"https://monday9pm.com/building-a-url-shorter-server-part-1-dancing-with-base62-de1af40f604c\">https://monday9pm.com/building-a-url-shorter-server-part-1-dancing-with-base62-de1af40f604c</a></li>\n</ul>","tableOfContents":"<ul>\n<li>\n<p><a href=\"/relink/#relink---url-shortener\">Relink - URL Shortener</a></p>\n<ul>\n<li><a href=\"/relink/#concept\">Concept</a></li>\n<li><a href=\"/relink/#requirements\">Requirements</a></li>\n<li><a href=\"/relink/#system-analysis\">System Analysis</a></li>\n<li><a href=\"/relink/#url-shortener-api\">URL Shortener API</a></li>\n<li><a href=\"/relink/#cache-1\">Cache</a></li>\n<li><a href=\"/relink/#bibliography\">Bibliography</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"Relink","description":"Java Spring based shortening service. Allows you to convert long URLs into shorter, more manageable versions.","images":["img/projects/relink-00.png","img/projects/relink-01.png","img/projects/relink-02.png"],"codePreview":"https://github.com/deveuge/relink","livePreview":"https://relink-app.onrender.com/","tags":["Java","Spring","System design"]}}},"pageContext":{"slug":"/relink/","previous":{"fields":{"slug":"/toxigent/"},"frontmatter":{"title":"Toxigent"}},"next":{"fields":{"slug":"/kingsmarch/"},"frontmatter":{"title":"Kingsmarch"}}}},"staticQueryHashes":["2841359383"]}